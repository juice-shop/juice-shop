<!--
  ~ Copyright (c) 2014-2026 Bjoern Kimminich & the OWASP Juice Shop contributors.
  ~ SPDX-License-Identifier: MIT
-->

<main>
  <mat-card appearance="outlined" class="card1 mat-elevation-z6 ">
    <div class="mdc-card mat-card-cvr">
      <mat-card-title>
        {{"LABEL_ORDER_HISTORY" | translate}}
      </mat-card-title>

      @if (!emptyState) {
      <section class="orders-container">
        @for (order of orders; track order) {
        <article>
          <section class="table-container mat-elevation-z4 custom-slate">
            <header class="heading">
              <section class="heading-row">
                <section class="col col-40 col-vertical">
                  <p>{{"LABEL_ORDER_ID" | translate}}</p>
                  <p>#{{ order.orderId }}</p>
                </section>
                <section class="col col-15 col-vertical">
                  <p>{{"LABEL_TOTAL_PRICE" | translate}}</p>
                  <p>{{ order.totalPrice.toFixed(2) }}&curren;</p>
                </section>
                <section class="col col-15 col-vertical">
                  <p>{{"LABEL_BONUS" | translate}}</p>
                  <p>{{ order.bonus }}</p>
                </section>
                <section class="col col-20">
                  @if (!order.delivered) {
                  <p class="error">{{"LABEL_IN_TRANSIT" | translate}}</p>
                  }
                  @if (order.delivered) {
                  <p class="confirmation">{{"LABEL_DELIVERED" | translate}}</p>
                  }
                </section>
                <section class="col col-5 align-end">
                  <button mat-icon-button aria-label="Track Your Order"
                    matTooltip="{{ 'LABEL_TRACK_ORDER' | translate }}" matTooltipPosition="below"
                    (click)="trackOrder(order.orderId)">
                    <mat-icon>local_shipping</mat-icon>
                  </button>
                </section>
                <section class="col col-5 align-end">
                  <button mat-icon-button aria-label="Print order confirmation"
                    matTooltip="{{ 'PRINT_ORDER_CONFIRMATION' | translate }}" matTooltipPosition="below"
                    (click)="openConfirmationPDF(order.orderId)">
                    <mat-icon>note</mat-icon>
                  </button>
                </section>
              </section>
              <div class="border"></div>
            </header>
            <mat-table [dataSource]="order.products">
              <ng-container matColumnDef="product">
                <mat-header-cell *matHeaderCellDef>{{"LABEL_PRODUCT" | translate}}</mat-header-cell>
                <mat-cell *matCellDef="let element">{{element.name}}</mat-cell>
              </ng-container>
              <ng-container matColumnDef="price">
                <mat-header-cell *matHeaderCellDef>{{"LABEL_PRICE" | translate}}</mat-header-cell>
                <mat-cell *matCellDef="let element">{{element.price}}&curren;</mat-cell>
              </ng-container>
              <ng-container matColumnDef="quantity">
                <mat-header-cell *matHeaderCellDef>{{"LABEL_QUANTITY" | translate}}</mat-header-cell>
                <mat-cell *matCellDef="let element">
                  <span>{{element.quantity}}</span>
                </mat-cell>
              </ng-container>
              <ng-container matColumnDef="total price">
                <mat-header-cell *matHeaderCellDef>{{"LABEL_TOTAL_PRICE" | translate}}</mat-header-cell>
                <mat-cell *matCellDef="let element" class="price-align">{{ (element.total).toFixed(2)
                  }}&curren;</mat-cell>
              </ng-container>
              <ng-container matColumnDef="review">
                <mat-header-cell *matHeaderCellDef></mat-header-cell>
                <mat-cell *matCellDef="let element">
                  <button mat-icon-button aria-label="Print order confirmation"
                    matTooltip="{{ 'WRITE_REVIEW' | translate }}" matTooltipPosition="below"
                    (click)="showDetail(element.id)">
                    <mat-icon>rate_review</mat-icon>
                  </button>
                </mat-cell>
              </ng-container>
              <mat-header-row *matHeaderRowDef="tableColumns"></mat-header-row>
              <mat-row *matRowDef="let row; columns: tableColumns;"></mat-row>
            </mat-table>
          </section>
        </article>
        }
      </section>
      } @else {
      <mat-card appearance="outlined" class="mat-elevation-z6 emptyState">
        <section class="mdc-card">
          <img alt="No results found" class="img-responsive noResult"
            src="assets/public/images/products/no-results.png">
          <mat-card-title>
            <p class="noResultText">
              {{"NO_SEARCH_RESULT" | translate}}
            </p>
          </mat-card-title>
          <mat-card-content>
            <p class="noResultText" translate>
              {{"NO_ORDERS_PLACED" | translate}}
            </p>
          </mat-card-content>
        </section>
      </mat-card>
      }

    </div>
  </mat-card>
</main>